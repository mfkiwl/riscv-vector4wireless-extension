[[chapter12]]
== Fast non-linear instruction implemenation and paramters
=== norm

. *Description*
+
normalization for the input data to [0.5~1).

. *Operation*
+
vs2 is 32bit fixpoint real number, vs1 is the fix point position, e.g. for a Q32.20 fixpoint value, it's fix point position number is 20.
+
----
x, E = norm(R_NL_TYPE, vs2, vs1)

eNorm =  lsb(vs2); // take 32 bit-width data for example
x = vs2 << eNorm;
E = 31 - eNorm - vs1ï¼›

----

=== preProc

. *Description*
+
preprocess for non-linear instruction.

. *Operation*
+
----
x, s, E = preproc(R_NL_TYPE, x, E)

if R_NL_TYPE == 0       % reciprocal
    s = sign(x);
    x = abs(x);

elsif R_NL_TYPE == 1    % square root
    isOddE = ceill(E/2) - floor(E/2);
    E   = E + isOddE;
    x   = x * (2^-isOddE);

elsif R_NL_TYPE == 2    % reciprocal of square root
    isOddE = ceill(E/2) - floor(E/2);
    E   = E + isOddE;
    x   = x * (2^-isOddE);

elsif R_NL_TYPE == 3    % log2

elsif R_NL_TYPE == 4    % arctan


----

=== findSeg

. *Description*
+
find which segment the input data belongs to in N-th segment group.

. *Operation*
+
----
segIdx = findSeg(x, R_SEG[N])  // N is segment group ID

for iSeg = R_SEG[N].nSegments        // segment number in one group
    lutIndex(iSeg) = x >=R_SEG[N].xStart(iSeg);
end
segIdx = sum(lutIndex);          // find which segment belong to
----


=== postProc

. *Description*
+
postprocess for non-linear instruction.

. *Operation*
+
----
vd = postproc(R_NL_TYPE, tmp, s)

if R_NL_TYPE == 0       % reciprocal
    vd.y = s * floor(tmp/2);

elsif R_NL_TYPE == 1    % square root
    vd.y = tmp

elsif R_NL_TYPE == 2    % reciprocal of square root
    vd.y = floor(tmp/2);

elsif R_NL_TYPE == 3    % log2

elsif R_NL_TYPE == 4    % arctan

----

=== expAdjust

. *Description*
+
adjust the exponent for the output.

. *Operation*
+
----
vd = ExpAdjust(R_NL_TYPE, E)

if R_NL_TYPE == 0       % reciprocal
    vd.E = -E+1-31;

elsif R_NL_TYPE == 1    % square root
    vd.E = ceil(E/2)-31;
   
elsif R_NL_TYPE == 2    % reciprocal of square root
    vd.E = -ceil(E/2)+1-31;
   
elsif R_NL_TYPE == 3    % log2

elsif R_NL_TYPE == 4    % arctan

----